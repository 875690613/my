import{r as c,d as P,e as ve,f as se,a as y,b as e,g as n,w as v,F as U,h as ie,c as S,i as z,j as re,v as de,s as N,N as ce,B as me,k as pe,l as fe,C as ge,P as ye,o as p,m as _,t as L,u as M,n as _e,D as ke}from"./index-Ca3J3ala.js";/* empty css              *//* empty css              */import{r as b}from"./request-BzyPSYD6.js";import{H as j}from"./html5-qrcode-scanner-DJB9E8eP.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ce="/assets/icon-success-BiWR0Sdg.png",be={class:"scrollMain"},xe={key:0,class:"scan-salary-wrapper"},we={key:1,class:"phone-wrapper"},Se={style:{margin:"16px"}},Ne={key:2,class:"salary-list-wrapper"},Ve={class:"salary-detail-wrapper"},De={style:{display:"flex","justify-content":"center","margin-top":"10px"}},$e={class:"scan-box"},Be={class:"back-li"},Ie={__name:"salary",setup(Ue){const k=c(!1),V=c(!1),f=c({}),x=c([]),l=c({}),q=P(()=>`${l.value.syear}年${l.value.smonth}月 工资明细`);let g=c(null);const h=c(),r=c(0),A=P(()=>({0:"工资查询",1:"身份验证",2:"工资查询",3:"工资明细"})[r.value]),C=c(!1),D=c(["2024"]),Q=new Date(2012,0,1),R=new Date,E=["year"],H=u=>{ee()},W=()=>{O()},G=()=>{console.log("stopScan..."),B()},J=()=>{r.value==0?history.back():$()},$=()=>{r.value=0,localStorage.removeItem("Authorization")},K=()=>{r.value=2};ve(()=>{}),se(()=>{B(),$(),localStorage.removeItem("Authorization"),g.value=null});const O=()=>{j.getCameras().then(u=>{u&&u.length&&(k.value=!0,g.value=new j("reader"),X())}).catch(u=>{alert(`获取设备信息失败${u}`)})},X=()=>{g.value.start({facingMode:"environment"},{fps:20,qrbox:{width:250,height:250}},(u,t)=>{console.log("decodedText: ",u),console.log("decodedResult: ",t);const s=u.split("&")[0];T(s),k.value=!1,B()},u=>{console.log("暂无扫描结果",u)}).catch(u=>{console.log(`Unable to start scanning, error: ${u}`)})},B=()=>{if(!(g.value&&typeof g.value.stop=="function")){k.value=!1;return}g.value.stop().then(u=>{k.value=!1,console.log("QR Code scanning stopped.",u)}).catch(u=>{console.log("Unable to stop scanning.",u)})},T=async u=>{h.value=u,localStorage.setItem("Authorization",u);const t=await Y();console.log("handleMCode data: ",t),f.value={name:t.userName,phone:t.phone},t&&t.code&&(r.value=1)},Y=()=>new Promise((u,t)=>{b.get("/api/machine/user",{}).then(s=>{console.log("getStaffInfo res:",s);const{code:i,data:d,message:m}=s;i==0?u(d.data):(console.log(m),t())})}),Z=async()=>{V.value=!0,b.post("/api/verCode/add",{phone:f.value.phone}).then(u=>{const{code:t}=u;t==0&&N("发送成功！")}),setTimeout(()=>{V.value=!1},3e4)},ee=()=>{b.get("/api/machine/user/salary/login",{...f.value}).then(u=>{const{code:t,message:s}=u;if(t==0){N(s),sessionStorage.setItem("token",u.data.data.token),r.value=2;const i={staffNo:h.value,year:"2024"};I(i)}})},le=u=>{console.log("dateChange val: ",u),C.value=!1;const t=u.selectedValues[0],s={staffNo:h.value,year:t};I(s)},I=u=>{b.get("/api/machine/user/salary/byUserStaffNo",u).then(t=>{var m;const{code:s,message:i,data:d}=t;s==0&&(r.value=2,((m=d==null?void 0:d.data)==null?void 0:m.length)>0?x.value=d.data:x.value=[],N(i))})},ae=u=>{b.get(`/api/machine/user/salary/byId/${u}`,{staffNo:h.value}).then(t=>{const{code:s,message:i,data:d}=t;s==0&&(l.value=d.data||{},r.value=3,N(i))})};let w=c(0);const te=()=>{if(w.value++,w.value>=5&&(T("230069"),w.value=0,sessionStorage.getItem("token"))){r.value=2;const u={staffNo:h.value,year:"2024"};I(u)}setTimeout(()=>{w.value=0},1e4)};return(u,t)=>{var F;const s=ce,i=me,d=_e,m=pe,ue=fe,a=ge,ne=ke,oe=ye;return p(),y(U,null,[e(s,{title:A.value,fixed:"",border:!1,"left-arrow":"","left-text":"返回",onClickLeft:J},null,8,["title"]),n("main",be,[r.value===0?(p(),y("div",xe,[n("div",{style:{"margin-bottom":"50px"}},[n("p",{onClick:te},"欢迎使用逐日企信通工资查询系统，请扫描员工码进行工资查询！")]),e(i,{onClick:W},{default:v(()=>t[7]||(t[7]=[_("开始查询")])),_:1})])):r.value===1?(p(),y("div",we,[t[9]||(t[9]=n("div",{style:{"margin-bottom":"30px"}},[n("div",{style:{"text-align":"center"}},[n("img",{src:Ce,alt:"",style:{width:"50%"}})]),n("div",{style:{"text-align":"center","font-size":"20px"}},"身份验证成功")],-1)),e(ue,{onSubmit:H,"label-width":"60px"},{default:v(()=>[e(m,{inset:""},{default:v(()=>[e(d,{modelValue:f.value.name,"onUpdate:modelValue":t[0]||(t[0]=o=>f.value.name=o),name:"姓名",label:"姓名",disabled:""},null,8,["modelValue"]),e(d,{modelValue:f.value.phone,"onUpdate:modelValue":t[1]||(t[1]=o=>f.value.phone=o),name:"手机号",label:"手机号",disabled:""},null,8,["modelValue"]),e(d,{modelValue:f.value.verCode,"onUpdate:modelValue":t[2]||(t[2]=o=>f.value.verCode=o),name:"验证码",label:"验证码",placeholder:"请输入验证码",rules:[{required:!0,message:"请填写验证码"}]},{button:v(()=>[e(i,{size:"mini",onClick:Z},{default:v(()=>[_(L(V.value?"已发送":"发送验证码"),1)]),_:1})]),_:1},8,["modelValue"])]),_:1}),n("div",Se,[e(i,{round:"",block:"",color:"#0C273F","native-type":"submit"},{default:v(()=>t[8]||(t[8]=[_(" 提交 ")])),_:1})])]),_:1})])):r.value===2?(p(),y("div",Ne,[n("div",null,[e(a,{title:"选择年份","is-link":"",onClick:t[3]||(t[3]=o=>C.value=!0),value:D.value[0]},null,8,["value"]),((F=x.value)==null?void 0:F.length)>0?(p(!0),y(U,{key:0},ie(x.value,o=>(p(),S(a,{key:o.id,title:`${o.syear}-${o.smonth} 工资薪金`,"is-link":"",value:"工资明细",onClick:ze=>ae(o.id)},{label:v(()=>[n("div",null,[n("div",null,"应发工资："+L(o.n5),1),n("div",null,"实发工资："+L(o.n13),1)])]),value:v(()=>t[10]||(t[10]=[n("div",{style:{color:"#1890FE"}}," 工资明细 ",-1)])),_:2},1032,["title","onClick"]))),128)):(p(),S(a,{key:1,title:"工资薪金"},{label:v(()=>t[11]||(t[11]=[n("div",{style:{"text-align":"center"}},"暂无数据",-1)])),_:1}))]),e(oe,{show:C.value,"onUpdate:show":t[6]||(t[6]=o=>C.value=o),position:"bottom"},{default:v(()=>[e(ne,{modelValue:D.value,"onUpdate:modelValue":t[4]||(t[4]=o=>D.value=o),"columns-type":E,title:"选择日期","min-date":M(Q),"max-date":M(R),onConfirm:le,onCancel:t[5]||(t[5]=o=>C.value=!1)},null,8,["modelValue","min-date","max-date"])]),_:1},8,["show"])])):r.value===3?(p(),y(U,{key:3},[n("div",Ve,[n("div",null,[e(m,{title:q.value},{default:v(()=>[e(a,{title:"应发工资",value:l.value.n17},null,8,["value"]),e(a,{title:"实发工资",value:l.value.n28},null,8,["value"])]),_:1},8,["title"]),n("div",null,[e(m,{title:"基本信息"},{default:v(()=>[e(a,{title:"姓名",value:l.value.staff},null,8,["value"]),e(a,{title:"部门名称",value:l.value.deptName},null,8,["value"]),e(a,{title:"岗位/职务",value:l.value.jobName||"--"},null,8,["value"]),e(a,{title:"工号",value:l.value.employeeNumber},null,8,["value"])]),_:1}),l.value.accountName=="江阴逐日信息科技有限公司"?(p(),S(m,{key:0,title:"工资明细"},{default:v(()=>[e(a,{title:"应出勤",value:l.value.n1||0},null,8,["value"]),e(a,{title:"事假",value:l.value.n2||0},null,8,["value"]),e(a,{title:"病假",value:l.value.n3||0},null,8,["value"]),e(a,{title:"年假",value:l.value.n4||0},null,8,["value"]),e(a,{title:"婚假",value:l.value.n5||0},null,8,["value"]),e(a,{title:"产假",value:l.value.n6||0},null,8,["value"]),e(a,{title:"丧假",value:l.value.n7||0},null,8,["value"]),e(a,{title:"调休",value:l.value.n8||0},null,8,["value"]),e(a,{title:"加班",value:l.value.n9||0},null,8,["value"]),e(a,{title:"未出勤",value:l.value.n10||0},null,8,["value"]),e(a,{title:"实出勤",value:l.value.n11||0},null,8,["value"]),e(a,{title:"基本工资",value:l.value.n12||0},null,8,["value"]),e(a,{title:"绩效及加班工资",value:l.value.n13||0},null,8,["value"]),e(a,{title:"考核部分",value:l.value.n14||0},null,8,["value"]),e(a,{title:"其它补贴",value:l.value.n15||0},null,8,["value"]),e(a,{title:"扣未出勤工资",value:l.value.n16||0},null,8,["value"]),e(a,{title:"应发",value:l.value.n17||0},null,8,["value"]),e(a,{title:"个人借款",value:l.value.n18||0},null,8,["value"]),e(a,{title:"应扣社保",value:l.value.n19||0},null,8,["value"]),e(a,{title:"实扣社保",value:l.value.n20||0},null,8,["value"]),e(a,{title:"应扣个税",value:l.value.n21||0},null,8,["value"]),e(a,{title:"实扣个税",value:l.value.n22||0},null,8,["value"]),e(a,{title:"应扣公积金",value:l.value.n23||0},null,8,["value"]),e(a,{title:"实扣公积金",value:l.value.n24||0},null,8,["value"]),e(a,{title:"事假扣除",value:l.value.n25||0},null,8,["value"]),e(a,{title:"病假扣除",value:l.value.n26||0},null,8,["value"]),e(a,{title:"其他扣除",value:l.value.n27||0},null,8,["value"]),e(a,{title:"实发",value:l.value.n28||0},null,8,["value"])]),_:1})):z("",!0),l.value.accountName=="靖江极客时装有限公司"?(p(),S(m,{key:1,title:"工资明细"},{default:v(()=>[e(a,{title:"实出天数",value:l.value.n29||0},null,8,["value"]),e(a,{title:"实出工时",value:l.value.n30||0},null,8,["value"]),e(a,{title:"正常出勤-工时",value:l.value.n32||0},null,8,["value"]),e(a,{title:"正常出勤-金额",value:l.value.n33||0},null,8,["value"]),e(a,{title:"日常加班-工时",value:l.value.n35||0},null,8,["value"]),e(a,{title:"日常加班-金额 1.5x",value:l.value.n36||0},null,8,["value"]),e(a,{title:"休息日加班-工时",value:l.value.n38||0},null,8,["value"]),e(a,{title:"休息日加班-金额 2x",value:l.value.n39||0},null,8,["value"]),e(a,{title:"法定节日加班-工时",value:l.value.n41||0},null,8,["value"]),e(a,{title:"法定节日加班-金额 3x",value:l.value.n42||0},null,8,["value"]),e(a,{title:"应发加班工资",value:l.value.n43||0},null,8,["value"]),e(a,{title:"基本工资",value:l.value.n44||0},null,8,["value"]),e(a,{title:"加班工资",value:l.value.n45||0},null,8,["value"]),e(a,{title:"绩效/补贴",value:l.value.n46||0},null,8,["value"]),e(a,{title:"应发工资",value:l.value.n47||0},null,8,["value"]),e(a,{title:"应扣保险",value:l.value.n48||0},null,8,["value"]),e(a,{title:"实扣保险",value:l.value.n49||0},null,8,["value"]),e(a,{title:"应扣所得税",value:l.value.n50||0},null,8,["value"]),e(a,{title:"实扣所得税",value:l.value.n51||0},null,8,["value"]),e(a,{title:"餐补扣除",value:l.value.n52||0},null,8,["value"]),e(a,{title:"交通补贴扣除",value:l.value.n53||0},null,8,["value"]),e(a,{title:"产量考核扣除",value:l.value.n54||0},null,8,["value"]),e(a,{title:"其他扣除",value:l.value.n55||0},null,8,["value"]),e(a,{title:"实发工资",value:l.value.n56||0},null,8,["value"])]),_:1})):z("",!0)])])]),n("div",De,[e(i,{onClick:K,round:"",size:"small",style:{width:"120px","margin-right":"20px"}},{default:v(()=>t[12]||(t[12]=[_("返回上一页")])),_:1}),e(i,{onClick:$,round:"",size:"small",style:{width:"120px"}},{default:v(()=>t[13]||(t[13]=[_("退出")])),_:1})])],64)):z("",!0)]),re(n("div",$e,[t[15]||(t[15]=n("div",{id:"reader"},null,-1)),n("div",Be,[e(i,{onClick:G},{default:v(()=>t[14]||(t[14]=[_("返回")])),_:1})])],512),[[de,k.value]])],64)}}},qe=he(Ie,[["__scopeId","data-v-99af81c8"]]);export{qe as default};
